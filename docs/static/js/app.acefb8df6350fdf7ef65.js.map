{"version":3,"sources":["webpack:///./src/module/imageicon.js","webpack:///./src/components/editor/index.vue?da91","webpack:///./src/components/editor/index.vue","webpack:///./src/main.js"],"names":["kity","window","Command","require","kityminder","Minder","Node","Module","Renderer","Render","module","exports","register","self","this","defaultOptions","hex_width","hex_height","commands","imageicon","createClass","base","execute","km","url","title","nodes","getSelectedNodes","callback","img","document","createElement","onload","width","height","onerror","src","loadImageSize","forEach","n","size","maxWidth","maxHeight","ratio","fitImageSize","getOption","setData","render","fire","layout","queryState","result","length","getData","queryValue","node","getSelectedNode","renderers","top","create","Image","shouldRender","update","image","box","spaceTop","getStyle","type","HEX_WIDTH","HEX_HEIGHT","urls","app","project","dir","page","setAttributeNS","x","y","setUrl","setX","setY","setWidth","setHeight","group","rc","getItems","find","a","constructor","name","setTranslate","getHeight","Box","editor","_h","$createElement","_self","_c","_v","staticRenderFns","components_editor","__webpack_require__","normalizeComponent","MindEditor","Editor","install","Vue","arguments","undefined","keys_default","key","component"],"mappings":"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","file":"static/js/app.acefb8df6350fdf7ef65.js","sourcesContent":["var kity = window.kity\nvar utils = require('kityminder-core/src/core/utils')\nvar Minder = window.kityminder.Minder\nvar MinderNode = window.kityminder.Node\nvar Command = window.kityminder.Command\nvar Module = window.kityminder.Module\nvar Renderer = window.kityminder.Render\n\nmodule.exports = Module.register('imageicon', function () {\n  var self = this\n\n  function loadImageSize (url, callback) {\n    var img = document.createElement('img')\n    img.onload = function () {\n      callback(img.width, img.height)\n    }\n    img.onerror = function () {\n      callback(null)\n    }\n    img.src = url\n  }\n\n  function fitImageSize (width, height, maxWidth, maxHeight) {\n    var ratio = width / height,\n      fitRatio = maxWidth / maxHeight\n\n    // 宽高比大于最大尺寸的宽高比，以宽度为标准适应\n    if (width > maxWidth && ratio > fitRatio) {\n      width = maxWidth\n      height = width / ratio\n    } else if (height > maxHeight) {\n      height = maxHeight\n      width = height * ratio\n    }\n\n    return {\n      width: width | 0,\n      height: height | 0\n    }\n  }\n\n  /**\n   * @command Image\n   * @description 为选中的节点添加图片\n   * @param {string} url 图片的 URL，设置为 null 移除\n   * @param {string} title 图片的说明\n   * @state\n   *   0: 当前有选中的节点\n   *  -1: 当前没有选中的节点\n   * @return 返回首个选中节点的图片信息，JSON 对象： `{url: url, title: title}`\n   */\n  var ImageIconCommand = kity.createClass('ImageIconCommand', {\n    base: Command,\n\n    execute: function (km, url, title) {\n      var nodes = km.getSelectedNodes()\n\n      loadImageSize(url, function (width, height) {\n        nodes.forEach(function (n) {\n          var size = fitImageSize(\n            width, height,\n            km.getOption('maxImageWidth'),\n            km.getOption('maxImageHeight'))\n          n.setData('imageicon', url)\n          n.setData('imageTitle', url && title)\n          n.setData('imageSize', url && size)\n          n.render()\n        })\n        km.fire('saveScene')\n        km.layout(300)\n      })\n    },\n    queryState: function (km) {\n      var nodes = km.getSelectedNodes(),\n        result = 0\n      if (nodes.length === 0) {\n        return -1\n      }\n      nodes.forEach(function (n) {\n        if (n && n.getData('image')) {\n          result = 0\n          return false\n        }\n      })\n      return result\n    },\n    queryValue: function (km) {\n      var node = km.getSelectedNode()\n      return {\n        url: node.getData('image'),\n        title: node.getData('imageTitle')\n      }\n    }\n  })\n\n  var ImageRenderer = kity.createClass('ImageRenderer', {\n    base: Renderer,\n\n    create: function (node) {\n      return new kity.Image(node.getData('imageicon'))\n    },\n\n    shouldRender: function (node) {\n      return node.getData('imageicon') || node.getData('hexType')\n    },\n\n    update: function (image, node, box) {\n      var url = node.getData('imageicon')\n      var title = node.getData('imageTitle')\n      var size = node.getData('imageSize')\n      var spaceTop = node.getStyle('space-top')\n      var type = node.getData('hexType')\n\n      var HEX_WIDTH = self.getOption('hex_width') || 20\n      var HEX_HEIGHT = self.getOption('hex_height') || 20\n      var urls = {\n        app: self.getOption('app_url'),\n        project: self.getOption('project_url'),\n        dir: self.getOption('dir_url'),\n        page: self.getOption('page_url')\n      }\n\n      if (type && urls[type]) {\n        size = size || {width: HEX_WIDTH, height: HEX_HEIGHT}\n        url = urls[type]\n      }\n\n      if (!size) return\n\n      if (title) {\n        image.node.setAttributeNS('http://www.w3.org/1999/xlink', 'title', title)\n      }\n\n      var x = -1 * size.width\n      var y = box.y - spaceTop\n\n      image.setUrl(url).setX(x | 0).setY(y | 0).setWidth(size.width | 0).setHeight(size.height | 0)\n\n      // use kity svg\n      var items = node.rc.getItems()\n      var group = items.find(a => a.constructor.name === 'Group')\n      group.setTranslate(2, (size.height - group.getHeight()) / 2 - spaceTop)\n\n      node.layout()\n\n      return new kity.Box(x | 0, y | 0, size.width | 0, size.height | 0)\n    }\n  })\n\n  return {\n    'defaultOptions': {\n      'hex_width': 20,\n      'hex_height': 20\n    },\n    'commands': {\n      'imageicon': ImageIconCommand\n    },\n    'renderers': {\n      'top': ImageRenderer\n    }\n  }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/module/imageicon.js","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._v(\"hello\")])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-46bdc842\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/editor/index.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nvar __vue_script__ = null\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-46bdc842\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/editor/index.vue\n// module id = null\n// module chunks = ","import 'kity'\nimport 'kityminder-core'\nimport Editor from './components/editor'\nimport './module/imageicon'\n\nconst MindEditor = {\n  Minder: Editor\n}\n\nconst install = function (Vue, opts = {}) {\n  Object.keys(MindEditor).forEach((key) => {\n    Vue.component(key, MindEditor[key])\n  })\n}\n\n// auto install\nif (typeof window !== 'undefined' && window.Vue) {\n  install(window.Vue)\n}\nMindEditor.install = install\nexport default MindEditor\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}